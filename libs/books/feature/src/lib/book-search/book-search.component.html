<form [formGroup]="searchForm" (submit)="searchBooks()">
  <mat-form-field>
    <input
      autoFocus
      matInput
      type="search"
      placeholder="{{ bookSearchConstants.BOOK_SEARCH.PLACEHOLDER_TEXT }}"
      formControlName="term"
    />
    <button
      mat-icon-button
      matSuffix
      aria-label="search book"
      data-testing="search-button"
      [disabled]="!searchForm.valid"
    >
      <mat-icon aria-label="search icon">{{
        bookSearchConstants.BOOK_SEARCH.SEARCH
      }}</mat-icon>
    </button>
    <button
      mat-icon-button
      matSuffix
      aria-label="reset book search"
      data-testing="clear-button"
      (click)="resetSearch()"
    >
      <mat-icon>{{ bookSearchConstants.BOOK_SEARCH.CLEAR }}</mat-icon>
    </button>
  </mat-form-field>
</form>

<!-- ERROR TEXT SECTION -->
<ng-container *ngIf="getBooksError$ | async">
  <p
    aria-live="assertive"
    class="error-text font-weight-bold"
    data-testing="error-text"
  >
    {{ bookSearchConstants.ERROR_TEXT }}
  </p>
</ng-container>

<!-- BOOKS LIST SECTION -->
<ng-container
  *ngIf="
    (books$ | async).length && (getBooksError$ | async) === null;
    else empty
  "
>
  <div class="book-grid" data-testing="books-list">
    <div
      class="book"
      data-testing="book-item"
      *ngFor="let book of books$ | async"
    >
      <div class="book-title">
        {{ book.title }}
      </div>
      <div class="book-content">
        <div class="book-cover">
          <img
            src="{{ book.coverUrl }}"
            alt="book cover"
            title="{{ book.title }}"
          />
        </div>
        <div class="book-content-info">
          <div>
            <span
              class="font-weight-bold"
              [innerHTML]="bookSearchConstants.BOOK_SEARCH.AUTHOR"
            ></span
            >:
            <span data-testing="book-author-name">{{
              book.authors?.join(', ') ||
                bookSearchConstants.NO_AUTHOR_MENTIONED
            }}</span>
          </div>
          <div>
            <span
              class="font-weight-bold"
              [innerHTML]="bookSearchConstants.BOOK_SEARCH.PUBLISHER"
            ></span
            >:
            {{
              book.publisher ||
                bookSearchConstants.BOOK_SEARCH.NO_PUBLISHER_MENTIONED
            }}
          </div>
          <div>
            <span
              class="font-weight-bold"
              [innerHTML]="bookSearchConstants.BOOK_SEARCH.PUBLISHED"
            ></span
            >:
            <span data-testing="book-published-date">
              {{
                (book.publishedDate
                  | date: bookSearchConstants.BOOK_SEARCH.DATE_FORMAT) ||
                  bookSearchConstants.BOOK_SEARCH.NO_DATE_MENTIONED
              }}</span
            >
          </div>
          <p
            data-testing="book-description"
            [innerHTML]="
              book.description ||
              bookSearchConstants.BOOK_SEARCH.NO_DESCRIPTION_MENTIONED
            "
          ></p>
          <div>
            <button
              mat-flat-button
              color="want-to-read-btn"
              (click)="addBookToReadingList(book)"
              [disabled]="book.isAdded"
              data-testing="add-book"
            >
            {{
              book.finished
                ? bookSearchConstants.BOOK_SEARCH.FINISHED
                : bookSearchConstants.BOOK_SEARCH.WANT_TO_READ
            }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<!-- EXAMPLE TEXT SECTION -->
<ng-template #empty>
  <div class="empty" data-testing="example-text-section">
    <p>
      {{ bookSearchConstants.BOOK_SEARCH.SEARCH_EXAMPLE_TEXT }} "
      <button
        class="search-example-btn"
        aria-label="Try searching for a topic, for example JavaScript"
        (click)="searchExample()"
      >
        {{ bookSearchConstants.BOOK_SEARCH.JAVASCRIPT }}</button
      >".
    </p>
  </div>
</ng-template>